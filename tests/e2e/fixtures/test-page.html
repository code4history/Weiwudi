<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weiwudi Test Page</title>
</head>

<body>
    <h1>Weiwudi E2E Test Page</h1>
    <div id="status">Initializing...</div>
    <div id="stats"></div>

    <script type="module">
        import Weiwudi from '/dist/weiwudi.es.js';

        window.weiwudiTest = {
            map: null,
            ready: false,
            error: null
        };

        async function init() {
            try {
                document.getElementById('status').textContent = 'Registering Service Worker...';

                // Register Service Worker - use built version from public/
                await Weiwudi.registerSW('./test-sw.js', { scope: '/tests/e2e/fixtures/' });

                document.getElementById('status').textContent = 'Registering map...';

                // Register a test map
                const map = await Weiwudi.registerMap('test_map', {
                    type: 'xyz',
                    width: 1024,
                    height: 1024,
                    url: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png'
                });

                window.weiwudiTest.map = map;
                window.weiwudiTest.ready = true;
                document.getElementById('status').textContent = 'Ready';

                // Update stats
                const stats = await map.stats();
                document.getElementById('stats').textContent = JSON.stringify(stats);
            } catch (e) {
                window.weiwudiTest.error = e.toString();
                document.getElementById('status').textContent = 'Error: ' + e.toString();
            }
        }

        init();
    </script>
</body>

</html>